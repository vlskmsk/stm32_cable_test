/*
 * sin_lookup.c
 *
 *  Created on: Oct 19, 2018
 *      Author: Ocanath
 */
#include "sin_lookup.h"


/*
 * TODO: find minimum acceptable lookup table size
 */

void theta_preprocess(float * theta, uint8_t * sign_flag)
{
	*sign_flag = 0;
	if(*theta > HALF_PI && *theta < PI)
	{
		*theta = PI-*theta;
	}
	else if(*theta > PI && *theta < THREE_BY_TWO_PI)
	{
		*sign_flag = 1;
		*theta = *theta - PI;
	}
	else if(*theta < 0 && *theta > -HALF_PI)
	{   *sign_flag = 1;
	*theta = -*theta;
	}
	else if(*theta < -HALF_PI && *theta > -PI)
	{
		*sign_flag = 1;
		*theta = *theta+PI;
	}
}

/*
 * INPUT: angle constrained -PI to PI, or -pi/2 to 3/2pi for cosine.
 *  	NOTE this constraint is not
 * 		performed here for performance reasons, but it is absolutely necessary
 *
 * OUTPUT: lookup table sine approximation
 *
 */
const float conv_ratio = LOOKUP_TABLE_SIZE/HALF_PI;
float sin_lookup(float theta)
{
	uint8_t sign_flag;
	theta_preprocess(&theta, &sign_flag);
	int lookup_idx = (int)(theta*conv_ratio);

	//TODO: after testing, remove this guard for performance
	if(lookup_idx < 0)
		lookup_idx = 0;
	else if(lookup_idx > LOOKUP_TABLE_SIZE-1)
		lookup_idx = LOOKUP_TABLE_SIZE-1;

	if(sign_flag == 0)
		return sin_lookup_table[lookup_idx];
	else
		return -sin_lookup_table[lookup_idx];
}
float cos_lookup(float theta)
{
	return sin_lookup(theta+HALF_PI);
}

float sin_lookup_table[LOOKUP_TABLE_SIZE] = {0.005236,
		0.010472,
		0.015707,
		0.020942,
		0.026177,
		0.031411,
		0.036644,
		0.041876,
		0.047106,
		0.052336,
		0.057564,
		0.062791,
		0.068015,
		0.073238,
		0.078459,
		0.083678,
		0.088894,
		0.094108,
		0.099320,
		0.104528,
		0.109734,
		0.114937,
		0.120137,
		0.125333,
		0.130526,
		0.135716,
		0.140901,
		0.146083,
		0.151261,
		0.156434,
		0.161604,
		0.166769,
		0.171929,
		0.177085,
		0.182236,
		0.187381,
		0.192522,
		0.197657,
		0.202787,
		0.207912,
		0.213030,
		0.218143,
		0.223250,
		0.228351,
		0.233445,
		0.238533,
		0.243615,
		0.248690,
		0.253758,
		0.258819,
		0.263873,
		0.268920,
		0.273959,
		0.278991,
		0.284015,
		0.289032,
		0.294040,
		0.299041,
		0.304033,
		0.309017,
		0.313992,
		0.318959,
		0.323917,
		0.328867,
		0.333807,
		0.338738,
		0.343660,
		0.348572,
		0.353475,
		0.358368,
		0.363251,
		0.368125,
		0.372988,
		0.377841,
		0.382683,
		0.387516,
		0.392337,
		0.397148,
		0.401948,
		0.406737,
		0.411514,
		0.416281,
		0.421036,
		0.425779,
		0.430511,
		0.435231,
		0.439939,
		0.444635,
		0.449319,
		0.453990,
		0.458650,
		0.463296,
		0.467930,
		0.472551,
		0.477159,
		0.481754,
		0.486335,
		0.490904,
		0.495459,
		0.500000,
		0.504528,
		0.509041,
		0.513541,
		0.518027,
		0.522499,
		0.526956,
		0.531399,
		0.535827,
		0.540240,
		0.544639,
		0.549023,
		0.553392,
		0.557745,
		0.562083,
		0.566406,
		0.570714,
		0.575005,
		0.579281,
		0.583541,
		0.587785,
		0.592013,
		0.596225,
		0.600420,
		0.604599,
		0.608761,
		0.612907,
		0.617036,
		0.621148,
		0.625243,
		0.629320,
		0.633381,
		0.637424,
		0.641450,
		0.645458,
		0.649448,
		0.653421,
		0.657375,
		0.661312,
		0.665230,
		0.669131,
		0.673013,
		0.676876,
		0.680721,
		0.684547,
		0.688355,
		0.692143,
		0.695913,
		0.699663,
		0.703395,
		0.707107,
		0.710799,
		0.714473,
		0.718126,
		0.721760,
		0.725374,
		0.728969,
		0.732543,
		0.736097,
		0.739631,
		0.743145,
		0.746638,
		0.750111,
		0.753563,
		0.756995,
		0.760406,
		0.763796,
		0.767165,
		0.770513,
		0.773840,
		0.777146,
		0.780430,
		0.783693,
		0.786935,
		0.790155,
		0.793353,
		0.796530,
		0.799685,
		0.802817,
		0.805928,
		0.809017,
		0.812084,
		0.815128,
		0.818150,
		0.821149,
		0.824126,
		0.827081,
		0.830012,
		0.832921,
		0.835807,
		0.838671,
		0.841511,
		0.844328,
		0.847122,
		0.849893,
		0.852640,
		0.855364,
		0.858065,
		0.860742,
		0.863396,
		0.866025,
		0.868632,
		0.871214,
		0.873772,
		0.876307,
		0.878817,
		0.881303,
		0.883766,
		0.886204,
		0.888617,
		0.891007,
		0.893371,
		0.895712,
		0.898028,
		0.900319,
		0.902585,
		0.904827,
		0.907044,
		0.909236,
		0.911403,
		0.913545,
		0.915663,
		0.917755,
		0.919821,
		0.921863,
		0.923880,
		0.925871,
		0.927836,
		0.929776,
		0.931691,
		0.933580,
		0.935444,
		0.937282,
		0.939094,
		0.940881,
		0.942641,
		0.944376,
		0.946085,
		0.947768,
		0.949425,
		0.951057,
		0.952661,
		0.954240,
		0.955793,
		0.957319,
		0.958820,
		0.960294,
		0.961741,
		0.963163,
		0.964557,
		0.965926,
		0.967268,
		0.968583,
		0.969872,
		0.971134,
		0.972370,
		0.973579,
		0.974761,
		0.975917,
		0.977046,
		0.978148,
		0.979223,
		0.980271,
		0.981293,
		0.982287,
		0.983255,
		0.984196,
		0.985109,
		0.985996,
		0.986856,
		0.987688,
		0.988494,
		0.989272,
		0.990024,
		0.990748,
		0.991445,
		0.992115,
		0.992757,
		0.993373,
		0.993961,
		0.994522,
		0.995056,
		0.995562,
		0.996041,
		0.996493,
		0.996917,
		0.997314,
		0.997684,
		0.998027,
		0.998342,
		0.998630,
		0.998890,
		0.999123,
		0.999328,
		0.999507,
		0.999657,
		0.999781,
		0.999877,
		0.999945,
		0.999986,
		1.000000};

